homepage: https://gitlab.com/morley-framework/morley
changelog-type: markdown
hash: 3d11c88c91eca2b803baaef7f3a9267db9898b9c4663f4e536518e8444e292ed
test-bench-deps:
  bimap: -any
  fmt: -any
  bytestring: -any
  morley-prelude: -any
  unordered-containers: -any
  hspec: -any
  text: -any
  morley: -any
  megaparsec: ! '>=7.0.0'
  syb: -any
  tasty-hspec: -any
  filepath: -any
  quickcheck-arbitrary-adt: -any
  constraints: -any
  base-noprelude: ! '>=4.7 && <5'
  data-default: -any
  HUnit: -any
  containers: -any
  singletons: -any
  vinyl: -any
  lens: -any
  quickcheck-instances: -any
  formatting: -any
  tasty-quickcheck: -any
  spoon: -any
  hex-text: -any
  tasty: -any
  QuickCheck: -any
  aeson: -any
  hspec-expectations: -any
  directory: -any
maintainer: Serokell <hi@serokell.io>
synopsis: Developer tools for the Michelson Language
changelog: |
  0.4.0
  =====

  * Implemented most of Babylon changes: new instructions, elimination of `big_map` restructions, new restrictions for the `contract` type, partial support for entrypoints. Some instructions have been removed/deprecated.
  * Many updates of helper data types for upgradeable contracts: `UParam` and `UStore`.
  * Michelson printer can produce pretty output, not just one line.
  * Added utilities for contract processing and analysis: optimizer, string transformer, errors transformer, analyzer.
  * Added `tasty` helpers to the testing engine.
  * Added annotations to typed representation and Lorentz.
  * Added automatic documentation generator.
  * Modified standard errors in Lorentz: now they are based on `CustomError`.
  * Added unpacking from readable representation.
  * Removed `parameter` and `storage` aliases, they were not very useful and complicated the code.
  * Extended cryptographic types and `Address` to work with other curves (tz2 and tz3 addresses).
  * Made it nearly impossible to generate dead code (which is illegal in Michelson) using Lorentz.
  * Various bug fixes.

  0.3.0.1
  =======

  * Update maintainer.

  0.3.0
  =====

  * [TM-68](https://issues.serokell.io/issue/TM-68) Lorentz DSL which allows one to write contracts directly in Haskell.
  May be moved to a separate package later.
  * [TM-132](https://issues.serokell.io/issue/TM-132) Names for contracts in integrational tests.
  * [TM-35](https://issues.serokell.io/issue/TM-35) `PACK` and `UNPACK` instructions.
  * [TM-27](https://issues.serokell.io/issue/TM-27) Proper handling of `FAILWITH`.
  * [TM-44](https://issues.serokell.io/issue/TM-44) [TM-124](https://issues.serokell.io/issue/TM-124) Reorganization of modules.
  * Bug fixes.

  0.2.0.1
  =======

  * Update documentation and metadata.

  0.2.0
  =====

  Initial release.

  * Typechecker and interpreter for Michelson.
  * Morley extensions:
    - syntax sugar
    - let-blocks
    - inline assertions
  * EDSL for unit testing and integrational testing
basic-deps:
  first-class-families: ! '>=0.5.0.0'
  bimap: -any
  fmt: -any
  bytestring: -any
  morley-prelude: -any
  timerep: -any
  time: -any
  parser-combinators: ! '>=1.0.0'
  aeson-pretty: -any
  unordered-containers: -any
  hspec: -any
  text: -any
  morley: -any
  megaparsec: ! '>=7.0.0'
  syb: -any
  aeson-options: -any
  gitrev: -any
  show-type: -any
  quickcheck-arbitrary-adt: -any
  constraints: ! '>=0.11'
  base-noprelude: ! '>=4.7 && <5'
  data-default: -any
  memory: -any
  containers: -any
  singletons: -any
  vinyl: -any
  lens: -any
  quickcheck-instances: -any
  wl-pprint-text: -any
  binary: -any
  pretty-terminal: -any
  ghc-prim: -any
  interpolate: -any
  formatting: -any
  base58-bytestring: -any
  cryptonite: -any
  mtl: -any
  pretty-simple: -any
  hex-text: -any
  tasty-hunit: -any
  base16-bytestring: -any
  optparse-applicative: -any
  tasty: -any
  named: -any
  QuickCheck: -any
  aeson: -any
  template-haskell: -any
  transformers-compat: ==0.6.5
  vector: -any
  tasty-ant-xml: -any
all-versions:
- 0.1.0.0
- 0.1.0.1
- 0.1.0.2
- 0.1.0.3
- 0.1.0.4
- 0.1.0.5
- 0.2.0
- 0.2.0.1
- 0.3.0
- 0.3.0.1
- 0.4.0
author: camlCase, Serokell, Tocqueville Group
latest: 0.4.0
description-type: markdown
description: |
  # Morley: Developer tools for the Michelson Language

  [![Hackage](https://img.shields.io/hackage/v/morley.svg)](https://hackage.haskell.org/package/morley)

  Morley is a library to make writing smart contracts in Michelson pleasant and
  effective.

  ## I: A reimplementation of the Michelson Language in Haskell

  It consists of the following parts:

  - [`Tezos.*`](/src/Tezos/) hierarchy is designed to implement cryptographic primitives, string and byte formats, and any other functionality specific to the Tezos protocol which is required for testing/execution of Michelson contracts but is used not only by Michelson.
  - [`Michelson.Untyped`](/src/Michelson/Untyped.hs) and [`Michelson.Typed`](src/Michelson/Typed.hs) hierarchies define Haskell data types that assemble a Michelson contract. See [michelsonTypes.md](/docs/michelsonTypes.md).
  - [`Michelson.TypeCheck`](/src/Michelson/TypeCheck.hs): A typechecker that validates Michelson contracts according to the Michelson's typing rules. Essentially, it performs conversion from untyped representation to the typed one. See [morleyTypechecker.md](/docs/morleyTypechecker.md).
  - [`Michelson.Interpret`](/src/Michelson/Interpret.hs): An interpreter for Michelson contracts which doesn't perform any side effects. See [morleyInterpreter.md](/docs/morleyInterpreter.md).
  - [`Michelson.Macro`](/src/Michelson/Macro.hs) Types for macros, syntactic sugar, and other extensions that are described in the next chapter.
  - [`Michelson.Parser`](/src/Michelson/Parser.hs) A parser to turn a `.tz` or `.mtz` file (`.mtz` is a Michelson contract with Morley extensions) into a Haskell ADT.
  - [`Michelson.Runtime`](/src/Michelson/Runtime.hs): A high-level interface to Morley functionality, see [morleyRuntime.md](/docs/morleyRuntime.md).

  ## II: Morley extensions

  One way to test Michelson contracts is to use the Morley language.
  It is a superset of the Michelson language, which means that each Michelson contract is also a valid Morley contract but not vice versa.
  There are several extensions which make it more convenient to write Michelson contracts and test them.
  For example, one can write inline assertions in their contracts for testing.
  All the details can be found in [the document](/docs/morleyLanguage.md) about these extensions.
  Also, there is a transpiler from Morley to Michelson.

  ## III: Morley-to-Michelson transpiler

  Morley-to-Michelson transpiler can be used to produce a Michelson contract from a Morley contract.
  You should use it if you want to develop contracts in Morley and submit them to the Tezos network.
  Workflow is the following:

  1. If your contract is called `foo.mtz`, use `morley print --contract foo.mtz --output foo.tz`. Note that normally you should not use `morley` directly, you should use `morley.sh` or `stack exec -- morley`. See usage instructions below.
  2. After that, you can use existing Tezos tools to deploy your contract. You can also typecheck or interpret it using a reference implementation. If you are not familiar with the Tezos tooling, please read [Tezos documentation](http://tezos.gitlab.io/zeronet/index.html) or [Michelson tutorial](https://gitlab.com/morley-framework/michelson-tutorial).

  ## IV: Lorentz EDSL

  <!-- This section is to be proof-read -->

  Lorentz is a powerful meta-programming tool which allows one to write contracts directly in Haskell.

  Haskell's type checker and automatic type inference facilitate contracts implementation and reduce boilerplate related to types. Adoption of Algebraic Data Types makes work with complex objects safe and convenient.
  Later Lorentz contract can be dumped as a plain textual Michelson contract using functions from [`Michelson.Printer`](/src/Michelson/Printer.hs).

  You can find Lorentz instructions in [`Lorentz`](/src/Lorentz.hs) modules.

  Examples of using Lorentz eDSL reside in the [`morley-ledgers`](/morley-ledgers) package.
  For more information, refer to this package [README](/morley-ledgers/README.md).

  ## V: Testing EDSL

  Another way to test Michelson contracts is to write tests in Haskell using the testing EDSL provided by Morley.
  It supports both integrational and unit tests.
  Tests of both types can use static data or arbitrary data.
  There is [a document](/docs/testingEDSL.md) with a detailed description of the EDSL and a tutorial about its usage.

  ## Running and building

  Morley executable provides the following functionality:
  - `parse` contract and return its representation in Haskell types.
  - `typecheck` contract.
  - `run` contract. A given contract is being originated first, and then the transaction is being sent to it
  - `originate` contract.
  - `transfer` tokens to a given address.
  - `print` produce `.tz` contract that can be parsed by the OCaml referenced client from `.mtz` or `.tz` contract.

  You can get more info about this command by running `morley <command> --help`

  There are two ways to get Morley executable:
  - [Docker](https://docs.docker.com/) based (preferable).
    * Get [script](/scripts/morley.sh)
   (e. g. using `curl https://gitlab.com/morley-framework/morley/raw/master/scripts/morley.sh > morley.sh`)
    and run it `./morley.sh <args>`. This script will pull a docker image that contains the latest version of Morley executable from the master branch and run it with the given arguments.
    * Usage example:
      + `./morley.sh` to see help message
      + `./morley.sh run --contract add1.tz --storage 1 --parameter 1 --amount 1`
  - [Stack](https://docs.haskellstack.org/en/stable/README/) based.
    * Clone this git repository and run `stack build` command,
      after that you can do `stack exec -- morley <args>` to run morley executable built from the source code.
    * Usage example:
      + `stack exec -- morley --help` to see help message
      + `stack exec -- morley originate --contract contracts/tezos_examples/attic/add1.tz --storage 1 --verbose`
  - [Cabal](https://www.haskell.org/cabal/) based.
    * Clone this git repository and run `cabal new-update && cabal new-build` command,
      after that you can do `cabal run -- morley <args>` to run morley executable built from the source code.
    * Usage example:
      + `cabal run -- morley --help` to see help message
      + `cabal run -- morley originate --contract contracts/tezos_examples/attic/add1.tz --storage 1 --verbose`

  For more information about Morley commands, check out the following docs:
  - [Interpreter doc](/docs/morleyInterpreter.md)
  - [Typechecker doc](/docs/morleyTypechecker.md)

  ## Michelson version

  `master` and `production` branches are maintained to be compatible with version of Michelson running on mainnet.
  We use separate branches to support other versions.
  More information about our branching strategy can be found [here](/docs/branching.md).

  ## Issue Tracker

  We used to use [YouTrack](https://issues.serokell.io/issues/TM) as our primary issue tracker.
  You may see that commit messages up to some date are prefixed with `[TM-X]`.
  This prefix refers to an issue in our YouTrack.
  YouTrack issues are public, so you can open any of them.

  Nowadays we are using built-in issue tracker on GitLab.

  ## For Contributors

  Please see [CONTRIBUTING.md](CONTRIBUTING.md) for more information.
license-name: AGPL-3.0-or-later
