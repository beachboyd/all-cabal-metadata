homepage: https://github.com/jfischoff/tmp-postgres#readme
changelog-type: markdown
hash: b0e331aaec93cfec1c3d13c18a337168017a60c6608212dff0a7f92fe02959dd
test-bench-deps:
  tmp-postgres: -any
  unix: -any
  base: -any
  hspec: -any
  port-utils: -any
  criterion: -any
  process: -any
  postgres-options: -any
  containers: -any
  postgresql-simple: -any
  mtl: -any
  temporary: -any
  directory: -any
maintainer: jonathangfischoff@gmail.com
synopsis: Start and stop a temporary postgres
changelog: |
  Changelog for tmp-postgres

  1.7.1.0
    #35 Add Lenses for configuration

  1.8.0.0
    Get rid of `Partial` prefix. Add a `Complete` prefix to the internal configuration types.
    Remove the `partial` prefix.
    Expand abbreviations.
    Order the Event type creation time.

  1.9.0.0
    #41 Configurable temporary directory
    #59 Change EnvVars to EnvironmentVariables

  1.9.0.1
    Documentation fixes

  1.9.0.2
    Documentation fixes

  1.10.0.0
    #58 Add connection timeout
    Rename partialPlanLoggerL to loggerL
    Add temporaryDirectoryL
    #31 A silent defaults
    #20 Include stderr in errors

  1.11.0.0
    #90 Extend generated config to provide default Handles and connection timeout.
    #81 Create public Config module for better documentation organization.

  1.12.0.0
    #64 Add the 'withNewDB' and 'withNewDBConfig' functions

  1.12.0.1
    Documentation fixes

  1.13.0.0
    #108 'startNewDBConfig' functions added and related
basic-deps:
  bytestring: -any
  ansi-wl-pprint: -any
  unix: -any
  base: ! '>=4.6 && <5'
  port-utils: -any
  process: ! '>=1.2.0.0'
  postgres-options: ! '>=0.2.0.0'
  async: -any
  containers: -any
  generic-monoid: -any
  postgresql-simple: -any
  transformers: -any
  temporary: -any
  random: -any
  directory: -any
all-versions:
- 0.1.0.0
- 0.1.0.1
- 0.1.0.2
- 0.1.0.3
- 0.1.0.4
- 0.1.0.5
- 0.1.0.6
- 0.1.0.7
- 0.1.0.8
- 0.1.1.0
- 0.1.1.1
- 0.1.2.0
- 0.1.2.1
- 0.1.2.2
- 0.2.0.0
- 0.3.0.0
- 0.3.0.1
- 1.0.0.0
- 1.0.0.1
- 1.0.0.2
- 1.0.1.0
- 1.2.0.0
- 1.2.0.1
- 1.2.1.0
- 1.3.0.0
- 1.4.0.0
- 1.5.0.0
- 1.6.0.0
- 1.7.0.0
- 1.7.0.1
- 1.7.1.0
- 1.8.0.0
- 1.9.0.0
- 1.9.0.1
- 1.9.0.2
- 1.10.0.0
- 1.11.0.0
- 1.12.0.0
- 1.12.0.1
- 1.13.0.0
author: Jonathan Fischoff
latest: 1.13.0.0
description-type: markdown
description: |
  [![Hackage](https://img.shields.io/hackage/v/tmp-postgres.svg?style=flat)](https://hackage.haskell.org/package/tmp-postgres)
  [![Travis CI Status](https://travis-ci.org/jfischoff/tmp-postgres.svg?branch=master)](http://travis-ci.org/jfischoff/tmp-postgres)
  # tmp-postgres

  `tmp-postgres` provides functions for creating a temporary `postgres` instance.
  By default it will create a temporary data directory and
  a temporary directory for a UNIX domain socket for `postgres` to listen on.

  Here is an example using the expection safe 'with' function:

  ```haskell
  with $ \db -> bracket
    (connectPostgreSQL (toConnectionString db))
    close $
    \conn -> execute_ conn "CREATE TABLE foo (id int)"
  ```

  To extend or override the defaults use `withConfig` (or `startConfig`).

  `tmp-postgres` ultimately calls (optionally) `initdb`, `postgres` and
  (optionally) `createdb`.

  All of the command line, environment variables and configuration files
  that are generated by default for the respective executables can be
  extended.

  In general `tmp-postgres` is useful if you want a clean temporary
  `postgres` and do not want to worry about clashing with an existing
  postgres instance (or needing to ensure `postgres` is already running).

  Here are some different use cases for `tmp-postgres` and their respective
  configurations:

  * The default 'with' and 'start' functions can be used to make a sandboxed
  temporary database for testing.
  * By disabling `initdb` one could run a temporary
  isolated postgres on a base backup to test a migration.
  * By using the 'stopPostgres' and 'withRestart' functions one can test
  backup strategies.

  WARNING!!
  Ubuntu's PostgreSQL installation does not put `initdb` on the `PATH`. We need to add it manually.
  The necessary binaries are in the `\/usr\/lib\/postgresql\/VERSION\/bin\/` directory, and should be added to the `PATH`

   > echo "export PATH=$PATH:/usr/lib/postgresql/VERSION/bin/" >> /home/ubuntu/.bashrc

  # Installation

  ## macOS
  ```
  $ brew install postgres
  $ stack install tmp-postgres
  ```

  ## Ubuntu

  Ubuntu's PostgreSQL installation does not put `initdb` on the PATH. We need to add it manually.

  ```
  $ sudo apt-get install postgresql-VERSION
  $ echo "export PATH=$PATH:/usr/lib/postgresql/VERSION/bin/" >> /home/ubuntu/.bashrc
  $ stack install tmp-postgres
  ```
license-name: BSD-3-Clause
